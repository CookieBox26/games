<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>hogehoge</title>
<style type="text/css">
*, *:before, *:after {
  box-sizing: border-box;
}
body {
  color: #242424;
  font-family: 'Verdana', 'BIZ UDGothic', sans-serif;
  background: azure;
  margin: 10px;
}
div.container {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
}
div.box {
  background: gainsboro;
  width: 130px;
  height: 170px;
  padding: 15px;
  position: relative;
}
div.over {
  background: gold;
}
div.item {
  background: linear-gradient(skyblue, 70%, pink);
  width: 100px;
  height: 140px;
  border: 6px solid darkgray;
  border-radius: 6px;
  position: absolute;
  top: 15px;
  left: 15px;
}
.dragging {
  opacity: 0.4;
}
.drag-preview {
  position: fixed;
  pointer-events: none;
  z-index: 1000;
  opacity: 0.5;
  display: none;
  transform: translate(-50%, -50%);
}
div.item > div {
  background: #ffffff;
  margin: 10px;
  text-align: center;
  font-size: x-large;
  padding: 5px;
}
</style>
</head>
<body>

<div class="container">

<div class="box box1">
<div class="item" draggable="true" id="item1"><div>馬脚</div></div>
</div>

<div class="box box2">
<div class="item" draggable="true" id="item2"><div>端麗</div></div>
</div>

<div class="box box3">
顔かたちが整っていて美しいこと。
</div>

<div class="box box4">
「■■をあらわす」の形で用い、隠していたことが現れること。
</div>

</div>

<script type="text/javascript"><!--
// ----- パソコンでのドラッグドロップ用 -----
const handleDragStart = (e) => {
  // アイテムをドラッグ開始したときのイベント
  e.target.classList.add("dragging");
  e.dataTransfer.effectAllowed = "move";  // ドロップ効果の設定
  const { id } = e.target;  // 転送するデータの設定
  e.dataTransfer.setData("application/json", JSON.stringify({ id }));
};
const handleDragEnd = (e) => {
  // アイテムをドラッグ終了したときのイベント
  e.target.classList.remove("dragging");
};
// アイテムたちにイベントを登録
document.querySelectorAll(".item").forEach(item => {
  item.addEventListener("dragstart", handleDragStart, false);
  item.addEventListener("dragend", handleDragEnd, false);
});

const handleDragEnter = (e) => {
  // ボックス上空にアイテムが重なってきたときのイベント
  if ((![...e.target.classList].includes("bench") && (e.target.childElementCount > 0))
      || [...e.target.classList].includes("item")) {
    return;
  }
  e.target.classList.add("over");
};
const handleDragLeave = (e) => {
  // ボックス上空からアイテムが去っていったときのイベント
  e.target.classList.remove("over");
};
const handleDragOver = (e) => {
  // ボックス上空にアイテムがいるときのイベント
  e.preventDefault();  // ブラウザ既定の処理を禁止
  e.dataTransfer.dropEffect = [...e.target.classList].includes("item") ? "none" : "move";
};
// ボックス上空でアイテムが手放されたときのイベント (パソコン)
const handleDrop = (e) => {
  e.preventDefault();  // ブラウザ既定の処理を禁止
  e.target.classList.remove("over");
  if ((![...e.target.classList].includes("bench")
      && (e.target.childElementCount > 0))
      || e.dataTransfer.files.length > 0) {
    return;
  }
  // ドロップ先に要素を追加
  const { id } = JSON.parse(e.dataTransfer.getData("application/json"));
  e.target.appendChild(document.getElementById(id));
};
// ボックスたちにイベントを登録
document.querySelectorAll(".box").forEach(box => {
  box.addEventListener("dragenter", handleDragEnter, false);
  box.addEventListener("dragleave", handleDragLeave, false);
  box.addEventListener("dragover", handleDragOver, false);
  box.addEventListener("drop", handleDrop, false);
});

// ----- スマートフォンでのドラッグドロップ用 -----
let draggedItem = null; // ドラッグ中のアイテム
let dragPreview = null; // 指に追従させるアイテム
const handleTouchStart = (e) => {
  // 画面にタッチしたときのイベント
  const target = e.target;
  if (!target.classList.contains("item")) return;
  draggedItem = target;
  draggedItem.classList.add("dragging");
  // 指に追従させるアイテムを作成
  dragPreview = draggedItem.cloneNode(true);
  dragPreview.classList.add("drag-preview");
  document.body.appendChild(dragPreview);
};
const handleTouchMove = (e) => {
  // 画面にタッチしている指を動かしたときのイベント
  e.preventDefault();  // ブラウザ既定の処理を禁止
  const touch = e.touches[0];  // 最初のタッチポイント
  if (dragPreview) {  // 指に追従させるアイテムを指に追従させる
    dragPreview.style.left = `${touch.clientX}px`;
    dragPreview.style.top = `${touch.clientY}px`;
    dragPreview.style.display = "block";
  }
  const element = document.elementFromPoint(touch.clientX, touch.clientY);
  if ((element && element.classList.contains("box"))
      && !((![...element.classList].includes("bench") && (element.childElementCount > 0))
           || [...element.classList].includes("item"))) {
    // 有効なボックスが検出された場合
    element.classList.add("over");
  }
};
const handleTouchEnd = (e) => {
  // 画面にタッチしている指を放したときのイベント
  e.preventDefault();  // ブラウザ既定の処理を禁止
  const touch = e.changedTouches[0];  // タッチ終了位置
  const element = document.elementFromPoint(touch.clientX, touch.clientY);
  if ((element && element.classList.contains("box"))
      && !((![...element.classList].includes("bench") && (element.childElementCount > 0))
           || [...element.classList].includes("item"))) {
    // 有効なドロップ先であった場合
    element.appendChild(draggedItem);
  }
  // リセット
  if (dragPreview) {
    dragPreview.remove();
    dragPreview = null;
  }
  draggedItem.classList.remove("dragging");
  document.querySelectorAll(".box").forEach(box => {
    box.classList.remove("over");
  });
  draggedItem = null;
};
if ("ontouchstart" in window) {
  // スマートフォンであったら画面にイベントを登録
  document.addEventListener("touchstart", handleTouchStart, { passive: false });
  document.addEventListener("touchmove", handleTouchMove, { passive: false });
  document.addEventListener("touchend", handleTouchEnd, false);
}
// --></script>
</body>
</html>
